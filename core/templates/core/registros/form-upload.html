{% extends "core/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}

{% block main %}
<div class="container col-8">
  <h3 style="margin-top: 15px;">{{ titulo }}</h3>
  <hr>

  <form method="POST" action="" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="mb-3 form-group">
      <label for="{{ form.tema.id_for_label }} floatingInput" class="form-label">Tema</label>
      {{ form.tema|add_class:"form-control"}}
    </div>

    <div class="mb-3 form-group">
      <label for="{{ form.descricao.id_for_label }}" class="form-label">Descrição</label>
      {{ form.descricao|add_class:"form-control" }}
    </div>

    <div class="mb-3 form-group">
      <label for="{{ form.local.id_for_label }}" class="form-label">Local</label>
      {{ form.local|add_class:"form-select" }}
    </div>

    <div class="mb-3 form-group">
      <label for="{{ form.quantidade_ptc.id_for_label }}" class="form-label">Quantidade de Participantes</label>
      {{ form.quantidade_ptc|add_class:"form-control" }}
    </div>

    <div class="mb-3 row">
      <div class="col-md-6 form-group">
        <label for="{{ form.data_inicio.id_for_label }}" class="form-label">Data de Início</label>
        {{ form.data_inicio|add_class:"form-control"|attr:"type:date" }}
      </div>

      <div class="col-md-6 form-group">
        <label for="{{ form.data_encerramento.id_for_label }}" class="form-label">Data de Encerramento</label>
        {{ form.data_encerramento|add_class:"form-control"|attr:"type:date"}}
      </div>
    </div>

    <div class="mb-3 form-group">
      <label for="{{ form.arquivos.id_for_label }}" class="form-label">Arquivos</label>
      {{ form.arquivos|add_class:"form-control"}}
    </div>
    
    <button type="submit" id="submit-button" class="btn btn-success" >{{ botao }}</button>
    <a href="{{ url }}" class="btn btn-danger">Cancelar</a>
  </form>
</div>
{% endblock main %}
{% block footer %}
<footer id="rodape" class="text-center text-white">
    <div class="container-fluid p-3">
        © 2023 Copyright: Felipe dos Santos & Alexandre Lira
    </div>
</footer>
{% endblock footer %}

{% block scrpits %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const submitButton = document.getElementById('submit-button');
    
    submitButton.addEventListener('click', async function(event) {
      event.preventDefault();  // Impede o envio padrão do formulário
  
      // Envie o formulário usando JavaScript
      const form = document.querySelector('form');
      const formData = new FormData(form);
      
      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData,
        });
  
        if (response.ok) {
          // Se a resposta for bem-sucedida, crie um blob do PDF
          const blob = await response.blob();
  
          // Crie um objeto URL para o blob
          const url = window.URL.createObjectURL(blob);
  
          // Crie um link temporário para o objeto URL
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = 'Relatório.pdf';  // Nome do arquivo de download
          document.body.appendChild(a);
  
          // Acione o clique no link
          a.click();
  
          // Remova o link temporário e libere o objeto URL
          window.URL.revokeObjectURL(url);
        } else {
          console.error('Erro ao gerar o PDF:', response.statusText);
        }
      } catch (error) {
        console.error('Erro ao gerar o PDF:', error);
      }
    });
  });
  </script>
  
{% endblock scrpits %}